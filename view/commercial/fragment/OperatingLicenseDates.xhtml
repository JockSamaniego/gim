<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:rich="http://richfaces.org/rich">

	<rich:modalPanel id="operatingLicenseDates" width="750" height="650" style="overflow-y:scroll">

		<f:facet name="header">

			<h:panelGroup>

				<h:outputText value="Impresión del permiso de funcionamiento" />

			</h:panelGroup>

		</f:facet>

		<f:facet name="controls">

			<h:panelGroup>

				<h:graphicImage value="/img/error.gif" style="cursor:pointer"
					id="hidelinkx" />

				<rich:componentControl for="operatingLicenseDates"
					attachTo="hidelinkx" operation="hide" event="onclick" />

			</h:panelGroup>

		</f:facet>

		<h:form id="formDates">
			
			<h:panelGrid width="100%" id="tramitex">
				<rich:panel id="contentPanel">
				
					<s:decorate id="formType" template="../../layout/edit.xhtml">
								<ui:define name="label">Permiso con formato?:</ui:define>
								<h:selectBooleanCheckbox id="type" value="#{businessHome.withFormat}" style="margin-left: 2em">
								<a:support event="onchange" reRender="contentPanel, panelButtons"
									ajaxSingle="true" />
								</h:selectBooleanCheckbox>
					</s:decorate>

					<h:panelGrid width="100%" columns="2">

						<s:decorate template="../../layout/edit.xhtml">
							<ui:define name="label">Año de permiso:</ui:define>
							<h:selectOneMenu id="currentFiscalPeriod" style="margin-left: 2em"
								value="#{businessHome.fiscalYear}" disabled="true" required="true">

								<f:selectItem itemValue="#{businessHome.year1}"
									itemLabel="#{businessHome.year1}" />

								<f:selectItem itemValue="#{businessHome.year2}"
									itemLabel="#{businessHome.year2}" />

								<f:selectItem itemValue="#{businessHome.year3}"
									itemLabel="#{businessHome.year3}" />

								<f:selectItem itemValue="#{businessHome.year4}"
									itemLabel="#{businessHome.year4}" />

								<f:selectItem itemValue="#{businessHome.year5}"
									itemLabel="#{businessHome.year5}" />

								<a:support event="onchange" ajaxSingle="true"
									action="#{businessHome.dates}"
									reRender="emissionDate, validityDate" />

							</h:selectOneMenu>
						</s:decorate>
						<s:decorate template="../../layout/edit.xhtml" rendered="#{!businessHome.withFormat}"> 
							<ui:define name="label">Número de especie:</ui:define>
							<h:inputText id="inputArea11" size="10" maxlength="10"
								required="#{!businessHome.withFormat}" style="margin-left: 2em"
								value="#{businessHome.codePaper}">
								<a:support event="onblur" reRender="inputArea11"
											ajaxSingle="true" />
							</h:inputText>
						</s:decorate>
						<div style="clear: both"></div>
					</h:panelGrid>
				</rich:panel>

			</h:panelGrid>

			<h:outputText value="* Por favor llene todos los datos"
				style="color:red" />

			<br />

			<h:outputText value="#{businessHome.message}" style="color:red"
				id="message" />

			<rich:panel id="contentPanelx">

				<f:facet name="header">

					<h:panelGrid columns="1" columnClasses="headerTitle,">

						<h:outputText value="Datos del local para la impresión" />

					</h:panelGrid>
				</f:facet>

				<s:decorate template="../../layout/edit.xhtml"> 
					<ui:define name="label">Nombre o razón social del establecimiento:</ui:define>
					<h:inputText id="inputArea1" size="58" maxlength="87"
						required="true" style="text-transform: uppercase"
						value="#{businessHome.local.name}">
					</h:inputText>
				</s:decorate>

				<s:decorate template="../../layout/edit.xhtml"> 
					<ui:define name="label">Nombre del propietario o representante legal:</ui:define>
					<h:inputText id="inputArea2" size="58" required="true"
					maxlength="87" style="text-transform: uppercase"
					value="#{businessHome.instance.owner.name}" />
				</s:decorate>

				<s:decorate template="../../layout/edit.xhtml"> 
					<ui:define name="label">Número de R.U.C. del establecimiento:</ui:define>
					<h:inputText id="inputArea3" size="30"
					required="true" maxlength="13"
					value="#{businessHome.local.business.cedruc}" />
				</s:decorate>

				<h:panelGrid width="100%" columns="2">
					<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Provincia:</ui:define>
						<h:inputText id="inputArea4" size="30"
						required="true" maxlength="21" disabled="true" value="LOJA" />
					</s:decorate>

					<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Cantón:</ui:define>
						<h:inputText id="inputArea5" size="30"
						style="text-transform: uppercase" required="true"
						maxlength="21" value="#{businessHome.local.address.city}" />
					</s:decorate>

					<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Parroquia:</ui:define>
						<h:selectOneMenu id="parishNames" required="true" 
							rendered="#{businessHome.local!=null}"
							value="#{businessHome.local.address.parish}">
							<s:selectItems value="#{businessHome.addParish()}" var="parishName"
								label="#{parishName}" noSelectionLabel="Seleccione uno" />
							<a:support event="onchange" ajaxSingle="true" />
						</h:selectOneMenu>
					</s:decorate>

					<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Barrio:</ui:define>
						<h:inputText id="inputArea7" size="30" maxlength="30"
					required="true" style="text-transform: uppercase;"
					value="#{businessHome.local.address.neighborhood}" />
					</s:decorate>

				</h:panelGrid>

				<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Dirección:</ui:define>
						<h:inputText id="inputArea8" size="93" maxlength="100"
					required="true" style="text-transform: uppercase;"
					value="#{businessHome.local.address.street}" />
				</s:decorate>

				<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Código del establecimiento:</ui:define>
						<h:inputText id="inputArea9" size="30"
						style="text-transform: uppercase" required="true"
						maxlength="10" value="#{businessHome.local.code}" />
				</s:decorate>

				<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Actividad(es)/tipo(s) de establecimiento(s):</ui:define>
						<h:inputTextarea id="inputArea10"
						style=" width : 530px; text-transform: uppercase" required="true"
						disabled="false" value="#{businessHome.economic_Activity}" />
				</s:decorate>


				<h:panelGrid width="100%" columns="2">

					<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Fecha de emisión:</ui:define>
						<rich:calendar id="emissionDate" required="true" ajaxSingle="true"
						value="#{businessHome.emissionDate}" disabled="true"
						datePattern="#{messages['common.datePattern']}" />
					</s:decorate>

					<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Fecha de vigencia:</ui:define>
						<rich:calendar id="validityDate" required="true" ajaxSingle="true"
						value="#{businessHome.validityDate}" disabled="true"
						datePattern="#{messages['common.datePattern']}" />
					</s:decorate>

				</h:panelGrid>

				<s:decorate template="../../layout/edit.xhtml"> 
						<ui:define name="label">Autoriza:</ui:define>
						<h:selectOneMenu id="signatureResponsible"  required="true"
								value="#{businessHome.sanitationCharge}">
								<s:selectItems value="#{businessHome.responsableCharges}"
									var="charge" noSelectionLabel="#{messages['common.chooseOption']}"
									label="#{charge.name}" />
								<a:support event="onchange" ajaxSingle="true" />
								<s:convertEntity></s:convertEntity>
						</h:selectOneMenu>
				</s:decorate>

				<div style="clear: both"></div>

			</rich:panel>

			<br />

			<div class="actionButtons">
				<rich:panel id="panelButtons">
					<a:commandButton id="printreport2"
						value="#{messages['common.print']} sin Formato"
						action="#{businessHome.printLicense()}"
						oncomplete="if (#{facesContext.maximumSeverity==null and businessHome.validCodePaper}) #{rich:component('printConfirmPanel2')}.show();"
						includePageParams="false" propagation="join"
						reRender="printConfirmPanel2, localsPanel, message, formDates"
						rendered="#{!businessHome.withFormat}" >
					</a:commandButton>
					<a:commandButton id="printreport3"
						value="#{messages['common.print']} con Formato"
						action="#{businessHome.loadCharge()}"
						oncomplete="if (#{facesContext.maximumSeverity==null}) #{rich:component('printConfirmPanel2')}.show();"
						includePageParams="false" propagation="join"
						reRender="printConfirmPanel2, localsPanel, message, formDates"
						rendered="#{businessHome.withFormat}" >
					</a:commandButton>
				
					<a:region>

						<a:commandButton id="cancelx" ajaxSingle="true"
							value="#{messages['common.quit']}"
							reRender="operatingLicenseDates"
							oncomplete="Richfaces.hideModalPanel('operatingLicenseDates');"
							bypassUpdates="true" />
					</a:region>

				</rich:panel>
			</div>
		</h:form>

	</rich:modalPanel>


	<rich:modalPanel id="printConfirmPanel2" width="1200" height="700"
		style="overflow:scroll">

		<f:facet name="header">#{messages['common.printingConfirmation']}</f:facet>

		<f:facet name="controls">

			<h:panelGroup>

				<h:graphicImage value="/img/error.gif" style="cursor:pointer"
					id="hidelink2" />

				<rich:componentControl for="printConfirmPanel2" attachTo="hidelink2"
					operation="hide" event="onclick" />

			</h:panelGroup>

		</f:facet>

		<h:form id="printConfirm2">

			<h:panelGrid>

				<rich:panel>

					<h:panelGrid columns="2">

						<h:graphicImage value="/img/alert.png" style="margin-left: 4em" />

						<h:outputText
							value="Por favor asegúrese que todos los datos estén ingresados correctamente antes de imprimir el permiso de funcionamiento!"
							style="font-size:large; color: red;margin-left: 2em" />

					</h:panelGrid>

				</rich:panel>

				<br />

				<rich:panel>

					<h:panelGrid columns="2" width="100%">

						<h:outputText value="Número de hoja de impresión:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{!businessHome.withFormat ? businessHome.codePaper : 'Auto-Generado'}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Nombre o razón social del establecimiento:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.local.name}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText
							value="Nombre del propietario o representante legal:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.instance.owner.name}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Número de RUC del establecimiento:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.local.business.cedruc}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Provincia:"
							style="font-size:large"></h:outputText>

						<h:outputText value="LOJA"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Cantón:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.local.address.city}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Parroquia:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.local.address.parish}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Barrio:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.local.address.neighborhood}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Dirección:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.local.address.street}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Código del establecimiento:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.local.code}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Actividad(es)/tipo(s) de establecimiento(s):"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.economic_Activity}"
							style="font-size:large;color:black"></h:outputText>

						<h:outputText value="Fecha de emisión:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.emissionDate}"
							style="font-size:large;color:black">
							<f:convertDateTime pattern="#{messages['common.datePattern']}" />
						</h:outputText>

						<h:outputText value="Fecha de vigencia:"
							style="font-size:large"></h:outputText>

						<h:outputText value="#{businessHome.validityDate}"
							style="font-size:large;color:black">
							<f:convertDateTime pattern="#{messages['common.datePattern']}" />
						</h:outputText>

						<h:outputText value="#{businessHome.sanitationCharge.department.toUpperCase()}:"
							style="font-size:large"></h:outputText>

						<h:outputText
							value="#{businessHome.sanitationDelegate.name.toUpperCase()}"
							style="font-size:large;color:black"></h:outputText>

					</h:panelGrid>

				</rich:panel>

				<br />

				<rich:panel>

					<h:panelGroup>

						<div class="actionButtons">


							<a:commandButton id="printreport22"
								value="#{messages['common.print']} y Generar PDF"
								oncomplete="Richfaces.hideModalPanel('printConfirmPanel2')"
								includePageParams="false" propagation="join"
								reRender="localsPanel, message"
								action="#{businessHome.confirmPrintLicense}">

							</a:commandButton>

							<a:commandButton ajaxSingle="true"
								value="#{messages['common.back']}"
								oncomplete="Richfaces.hideModalPanel('printConfirmPanel2');"
								bypassUpdates="true" />

						</div>

					</h:panelGroup>

				</rich:panel>

			</h:panelGrid>

		</h:form>

	</rich:modalPanel>
	
</ui:composition>