<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich" xmlns:g="http://gim.gob.ec/jsf"
	xmlns:a="http://richfaces.org/a4j" template="../layout/template.xhtml">

	<ui:define name="body">

		<h:form id="orderEmissionEdit" styleClass="edit">
			<h:outputText styleClass="formTitle"
				value="#{messages['EMISSION_ORDERPM']}" />

			<rich:panel>
				<f:facet name="header">
					<h:panelGrid columns="3" columnClasses="headerTitle,">
						<h:outputText value="#{messages['emissionOrder']}" />
					</h:panelGrid>
				</f:facet>
				<h:panelGrid columns="1">
					<s:decorate template="../layout/display.xhtml">
						<ui:define name="label">#{messages['resident.identificationNumber']}</ui:define>
						<h:inputText id="identificationNumber"
							value="#{emissionOrderHome.identificationNumber}">
							<a:support event="onblur" ajaxSingle="true"
								reRender="identificationNumber" />
						</h:inputText>
					</s:decorate>

					<s:decorate template="../layout/display.xhtml">
						<ui:define name="label">#{messages['resident.name']}</ui:define>
						<h:inputText id="residentName"
							value="#{emissionOrderHome.residentName}">
							<a:support event="onblur" ajaxSingle="true"
								reRender="residentName" />
						</h:inputText>
					</s:decorate>
				</h:panelGrid>

				<a:commandButton id="loadBt" ajaxSingle="true"
					action="#{emissionOrderHome.loadPending()}"
					eventsQueue="gimEventsQueue"
					reRender="emissionOrderTable,sc2,txtTotal"
					value="#{messages['common.search']}" />

			</rich:panel>

			<rich:panel>
				<f:facet name="header">
					<h:panelGrid columns="3" columnClasses="headerTitle,">
						<h:outputText id="txtTotal"
							value="#{messages['municipalBond.searchResults']} (#{empty emissionOrderHome.emissionOrders ? 0 : (emissionOrderHome.emissionOrders.size())})" />
					</h:panelGrid>
				</f:facet>



				<rich:dataTable id="emissionOrderTable" var="_emissionOrder"
					value="#{emissionOrderHome.emissionOrders}" rows="25">

					<rich:column>
						<f:facet name="header">
							<h:outputText value="#{_emissionOrder.id}" />
						</f:facet>
						<h:selectBooleanCheckbox value="#{ _emissionOrder.isSelected}">
							<a:support event="onchange" ajaxSingle="true"
								bypassUpdates="true" eventsQueue="gimQueue"
								action="#{emissionOrderHome.changeSelectedEmissionOrder(_emissionOrder, _emissionOrder.isSelected)}" />
						</h:selectBooleanCheckbox>
					</rich:column>

					<h:column>
						<f:facet name="header">
							<ui:include src="../layout/sort.xhtml">
								<ui:param name="entityList" value="#{emissionOrderList}" />
								<ui:param name="propertyLabel"
									value="#{messages['emissionOrder.number']}" />
								<ui:param name="propertyPath" value="e.id" />
							</ui:include>
						</f:facet>
						<h:outputText value="#{_emissionOrder.id}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<ui:include src="../layout/sort.xhtml">
								<ui:param name="entityList" value="#{emissionOrderList}" />
								<ui:param name="propertyLabel" value="#{messages['emisor']}" />
								<ui:param name="propertyPath" value="e.emisor" />
							</ui:include>
						</f:facet>
						<h:outputText value="#{_emissionOrder.emisor.name}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<ui:include src="../layout/sort.xhtml">
								<ui:param name="entityList" value="#{emissionOrderList}" />
								<ui:param name="propertyLabel"
									value="#{messages['emissionOrder.serviceDate']}" />
								<ui:param name="propertyPath" value="e.serviceDate" />
							</ui:include>
						</f:facet>
						<h:outputText value="#{_emissionOrder.serviceDate}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</h:column>

					<h:column>
						<f:facet name="header">
							<ui:include src="../layout/sort.xhtml">
								<ui:param name="entityList" value="#{emissionOrderList}" />
								<ui:param name="propertyLabel" value="#{messages['resident']}" />
								<ui:param name="propertyPath" value="m.resident.name" />
							</ui:include>
						</f:facet>
						<h:outputText
							value="#{_emissionOrder.municipalBonds.size() == 1 ? _emissionOrder.municipalBonds.get(0).resident.name : ''}" />
					</h:column>
					
					<h:column>
						<f:facet name="header">
							<ui:include src="../layout/sort.xhtml">
								<ui:param name="entityList" value="#{emissionOrderList}" />
								<ui:param name="propertyLabel"
									value="#{messages['emissionOrder.description']}" />
								<ui:param name="propertyPath" value="e.description" />
							</ui:include>
						</f:facet>
						<h:outputText value="#{_emissionOrder.description}" />
					</h:column>
					
					<h:column>
						<f:facet name="header">
							<ui:include src="../layout/sort.xhtml">
								<ui:param name="entityList" value="#{emissionOrderList}" />
								<ui:param name="propertyLabel" value="#{messages['vehicle.citationDate']}" />
								<ui:param name="propertyPath" value="m.adjunct.citationDate" />
							</ui:include>
						</f:facet>
						<h:outputText
							value="#{_emissionOrder.municipalBonds.size() == 1 ? _emissionOrder.municipalBonds.get(0).adjunct.citationDate : ''}" >
								<f:convertDateTime pattern="yyyy-MM-dd" />
							</h:outputText>
					</h:column>

					<rich:column styleClass="action">
						<f:facet name="header">#{messages['common.action']}</f:facet>
						<s:button view="/revenue/EmissionOrderEdit.xhtml"
							value="#{messages['common.detail']}" propagation="none"
							id="municipalBondList"
							rendered="#{_emissionOrder.municipalBonds.size() > 1}">
							<f:param name="emissionOrderId" value="#{_emissionOrder.id}" />
						</s:button>

						<a:commandButton id="viewer" ajaxSingle="true"
							rendered="#{_emissionOrder.municipalBonds.size() == 1}"
							action="#{municipalBondsViewerHome.loadMunicipalBond(_emissionOrder.municipalBonds.get(0))}"
							eventsQueue="gimEventsQueue" reRender="_municipalBondViewer"
							oncomplete="Richfaces.showModalPanel('_municipalBondViewer',{width:700, height:500})"
							value="#{messages['common.view']}" />

						<a:commandButton id="emitEmissionOrder"
							value="#{messages['common.emit']}"
							rendered="#{_emissionOrder.municipalBonds.size() == 1}"
							action="#{emissionOrderHome.emitEmissionOrder(_emissionOrder)}" />


						<a:commandButton id="rejectEmissionOrder"
							value="#{messages['municipalBond.reject']}"
							rendered="#{_emissionOrder.municipalBonds.size() == 1}"
							action="#{emissionOrderHome.rejectEmissionOrder(_emissionOrder)}" />

					</rich:column>
				</rich:dataTable>

				<rich:datascroller align="center" for="emissionOrderTable"
					maxPages="20" id="sc2" />

			</rich:panel>

			<div class="actionButtons">

				<a:commandButton id="emitEmissionOrder"
					value="#{messages['common.emit']}"
					action="#{emissionOrderHome.multipleEmission()}"
					reRender="emissionOrderTable,sc2,txtTotal"
					eventsQueue="gimEventsQueue" />

				<!-- h:commandButton id="emitEmissionOrder2"
					value="#{messages['common.emit hcb']}"
					action=" # - {
					emissionOrderHome.multipleEmission(-)}">
				</h:commandButton-->

				<a:commandButton id="rejectEmissionOrder"
					value="#{messages['municipalBond.reject']}"
					action="#{emissionOrderHome.multipleReject()}"
					reRender="emissionOrderTable,sc2,txtTotal"
					eventsQueue="gimEventsQueue" />


				<s:button id="back" value="#{messages['common.back']}"
					propagation="none" view="/home.xhtml">
					<f:param name="isDispatched" value="#{false}" />
				</s:button>

			</div>
		</h:form>

		<g:municipalBondViewer resident="#{municipalBondsViewerHome.resident}"
			municipalBondItemsForView="#{municipalBondsViewerHome.municipalBonds}" />

	</ui:define>

</ui:composition>
