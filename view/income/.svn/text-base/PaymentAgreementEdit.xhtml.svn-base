<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" 
	xmlns:g="http://gim.gob.ec/jsf"
	template="../layout/template.xhtml">

	<ui:define name="body">
	
		<ui:include src="fragment/PaymentAgreementDetailsPanel.xhtml" />

		<h:form id="paymentAgreement" styleClass="edit">
			<rich:panel bodyClass="topAligned">
				<f:facet name="header">#{messages['paymentAgreement.title']}</f:facet>
				<h:panelGrid columns="2" width="100%" columnClasses="topAligned, topAligned right">
					<a:outputPanel id="paymentTotalPanel">
						<g:residentChooser id="residentChooser" disabled="#{not empty paymentAgreementHome.instance.id}"
							showHandicapedPercentage="true"
							resident="#{paymentAgreementHome.instance.resident}"
							residentsList="#{paymentAgreementHome.residents}"
							identificationNumber="#{paymentAgreementHome.identificationNumber}"
							criteria="#{paymentAgreementHome.criteria}" bean="#{paymentAgreementHome}"
							searchByCriteriaAction="searchByCriteria"
							clearSearchPanelAction="clearSearchPanel" searchAction="search"
							residentChosenListenerName="residentSelectedListener"
							reRender="municipalBondsPanel, totalValueField, registerPaymentBtn" />
					</a:outputPanel>
					<h:panelGrid columnClasses="topAligned right" width="100%">
							<!-- ui:define name="label">#-{messages['paymentAgreement.total']}</ui:define-->
							<h:outputText  rendered="#{empty paymentAgreementHome.instance.id}"
								id="totalValueField"
								value="#{paymentAgreementHome.paymentAgreementTotal}" 
								size="10" 
								style="font-size:110px; font-weight:bold;"
								styleClass="right"
								maxlength="12">
								<f:convertNumber
										maxFractionDigits="#{messages['common.maxFractionDigits']}"
										minFractionDigits="#{messages['common.minFractionDigits']}" />
							</h:outputText>
							<a:commandButton id="registerPaymentBtn"
								action="#{paymentAgreementHome.clearValues()}"
								reRender="paymentAgreementDetailsPanel" 
								ajaxSingle="true"
								eventsQueue="gimEventsQueue"
								oncomplete="Richfaces.showModalPanel('paymentAgreementDetailsPanel',{width:800, height:560})"
								value="#{messages['paymentAgreement.register']}" 
								rendered="#{paymentAgreementHome.isSaveButtonDisabled or empty paymentAgreementHome.instance.id}"
								focus="receivedCashField"/>
					</h:panelGrid>
				</h:panelGrid>
				<div style="clear: both"/>
			</rich:panel>

			<a:outputPanel id="municipalBondsPanel" ajaxRendered="true" rendered="#{empty paymentAgreementHome.instance.id}">
				<rich:panel style="margin-top:5px;" rendered="#{empty paymentAgreementHome.municipalBondItems and not empty paymentAgreementHome.instance.resident}">
					<h:outputText 
						style="font-weight:bold; font-size:25px; color:#00FF00" 
						value="#{messages['paymentAgreement.noOverdueAccountsReceivableFound']}"/>
				</rich:panel>

				<rich:panel style="margin-top:5px;" rendered="#{not empty paymentAgreementHome.municipalBondItems and not empty paymentAgreementHome.instance.resident and not empty paymentAgreementHome.agreemetsExist}">
					<h:outputText 
						style="font-weight:bold; font-size:25px; color:red" 
						value="El contribuyente ya tiene convenio registrado"/>
				</rich:panel>
				
				<rich:panel style="margin-top:5px;" rendered="#{not empty paymentAgreementHome.instance.resident and paymentAgreementHome.personIsDead}">
					<h:outputText 
						style="font-weight:bold; font-size:25px; color:red" 
						value="El contribuyente estÃ¡ registrado como fallecido"/>
				</rich:panel>
				
							
				<rich:dataTable value="#{paymentAgreementHome.municipalBondItems}"
					var="_entryItem"
					rendered="#{not empty paymentAgreementHome.municipalBondItems and empty paymentAgreementHome.agreemetsExist and !paymentAgreementHome.personIsDead}"
					rowClasses="rvgRowOne,rvgRowTwo" id="municipalBondsTable"
					columnClasses="tableCellFont"
					style="margin-top:5px;">

					<f:facet name="header">
						<rich:columnGroup >
							<rich:column>
								<!-- 
								<h:selectBooleanCheckbox value="#-{paymentAgreementHome.allBondsSelected}">
									<a:support event="onchange"
										eventsQueue="gimQueue"
										action="#-{paymentAgreementHome.selectAllItems}"
										ajaxSingle="true" 
										reRender="municipalBondsPanel, totalValueField, registerPaymentBtn" />
								</h:selectBooleanCheckbox>
								 -->
							</rich:column>
							<rich:column colspan="3" styleClass="left">
								<h:outputText styleClass="tableTitle"
									value="#{messages['paymentAgreement.overdueBonds']}" />
							</rich:column>
							<rich:column>
								<h:outputText value="#{messages['municipalBond.value']}" />
							</rich:column> 
							<rich:column>
								<h:outputText value="#{messages['municipalBond.interestsTotal']}" />
							</rich:column>
							<rich:column>
								<h:outputText value="#{messages['municipalBond.discountsTotal']}" />
							</rich:column>
							<rich:column>
								<h:outputText value="#{messages['municipalBond.surchargesTotal']}" />
							</rich:column>
							<rich:column>
								<h:outputText value="#{messages['municipalBond.taxesTotal']}" />
							</rich:column>
							
							<rich:column>
								<h:outputText value="#{messages['municipalBond.paidTotal']}" />
							</rich:column>


						</rich:columnGroup>
					</f:facet>
					
					<rich:columnGroup styleClass="entryTitle">

					<rich:column>
						<!-- 
						<h:selectBooleanCheckbox value="#-{_entryItem.isSelected}">
							<a:support 
								event="onchange"
								eventsQueue="gimQueue"
								ajaxSingle="true"
								reRender="municipalBondsPanel, totalValueField, registerPaymentBtn" />
						</h:selectBooleanCheckbox>
						 -->
					</rich:column>

					<rich:column styleClass="left entryTitle" colspan="3">
						<h:outputText value="#{_entryItem.municipalBond.entry.name}">
						</h:outputText>
					</rich:column>
					
					<!-- jjjjjjjjjjjjjjjjjjjjjjjjjjjj -->

					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_entryItem.municipalBond.value}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>

					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_entryItem.municipalBond.interest}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_entryItem.municipalBond.discount}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_entryItem.municipalBond.surcharge}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_entryItem.municipalBond.taxesTotal}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_entryItem.municipalBond.paidTotal}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					</rich:columnGroup>
					<!-- jjjjjjjjjjjjjjjjjjjjjjjjjjjj -->


					<rich:subTable value="#{_entryItem.municipalBondItems}"
						var="_groupingItem">
						<rich:columnGroup styleClass="groupingTitle">
						<rich:column>
							<h:selectBooleanCheckbox value="#{_groupingItem.isSelected}">
								<a:support 
									event="onchange"
									action="#{paymentAgreementHome.calculatePaymentAgreementTotal()}"
									eventsQueue="gimQueue"
									ajaxSingle="true"
									reRender="municipalBondsPanel, totalValueField, registerPaymentBtn" />
							</h:selectBooleanCheckbox>
						</rich:column>
						
						
						<rich:column styleClass="left groupingTitle"
							colspan="3">
							<h:outputText
								value="#{_groupingItem.municipalBond.groupingCode} - #{_groupingItem.municipalBond.address}" />
						</rich:column>
						
					<!-- kkkkkkkkkkkkkkkkkkkkkkkkkkkk -->

					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_groupingItem.municipalBond.value}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>

					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_groupingItem.municipalBond.interest}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_groupingItem.municipalBond.discount}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_groupingItem.municipalBond.surcharge}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_groupingItem.municipalBond.taxesTotal}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="right">
						<h:outputText styleClass="tableTitle" value="#{_groupingItem.municipalBond.paidTotal}">
							<f:convertNumber
								maxFractionDigits="#{messages['common.maxFractionDigits']}"
								minFractionDigits="#{messages['common.minFractionDigits']}" />
						</h:outputText>
					</rich:column>
					</rich:columnGroup>
					<!-- kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk -->


						<rich:subTable value="#{_groupingItem.municipalBondItems}"
							var="_municipalBondItem">

							<rich:column width="1%" styleClass="center">
								<f:facet name="header">
								</f:facet>
								<h:selectBooleanCheckbox value="#{_municipalBondItem.isSelected}">
									<a:support 
										event="onchange"
										action="#{paymentAgreementHome.calculatePaymentAgreementTotal()}"
										eventsQueue="gimQueue"
										ajaxSingle="true"
										reRender="municipalBondsPanel, totalValueField, registerPaymentBtn" />
								</h:selectBooleanCheckbox>
							</rich:column>


							<rich:column width="8%" styleClass="center">
								<f:facet name="header">#{messages['municipalBond.emissionDate']}</f:facet>
								<h:outputText
									value="#{_municipalBondItem.municipalBond.emisionDate}">
									<s:convertDateTime type="date"
										pattern="#{messages['common.datePattern']}" />
								</h:outputText>
							</rich:column>

							<rich:column width="8%" styleClass="center">
								<f:facet name="header">#{messages['municipalBond.expirationDate']}</f:facet>
								<h:outputText
									value="#{_municipalBondItem.municipalBond.expirationDate}">
									<s:convertDateTime type="date"
										pattern="#{messages['common.datePattern']}" />
								</h:outputText>
							</rich:column>

							<!-- rich:column width="10%" styleClass="center">
								<f:facet name="header">#{messages['municipalBond.groupingCode']}</f:facet>
								<h:outputText
									value="#-{_municipalBondItem.municipalBond.groupingCode}" />
							</rich:column -->

							<rich:column>
								<f:facet name="header">#{messages['municipalBond.observation']}</f:facet>
								<h:outputText value="#{_municipalBondItem.serviceDate}" />
							</rich:column>

							<rich:column width="8%" styleClass="right">
								<f:facet name="header">#{messages['municipalBond.value']}</f:facet>
								<h:outputText value="#{_municipalBondItem.municipalBond.value}">
									<f:convertNumber
										maxFractionDigits="#{messages['common.maxFractionDigits']}"
										minFractionDigits="#{messages['common.minFractionDigits']}" />
								</h:outputText>
							</rich:column>
							<!-- 
					<rich:column>
						<f:facet name="header">#-{messages['municipalBond.dividendsTotal']}</f:facet>
						<h:outputText value="#-{_municipalBondItem.dividendsTotal}">
							<f:convertNumber />
						</h:outputText>
					</rich:column>
					 -->
							<rich:column width="8%" styleClass="right">
								<f:facet name="header">#{messages['municipalBond.interestsTotal']}</f:facet>
								<h:outputText value="#{_municipalBondItem.municipalBond.interest}">
									<f:convertNumber
										maxFractionDigits="#{messages['common.maxFractionDigits']}"
										minFractionDigits="#{messages['common.minFractionDigits']}" />
								</h:outputText>
							</rich:column>

							<rich:column width="8%" styleClass="right">
								<f:facet name="header">#{messages['municipalBond.discountsTotal']}</f:facet>
								<h:outputText value="#{_municipalBondItem.municipalBond.discount}">
									<f:convertNumber
										maxFractionDigits="#{messages['common.maxFractionDigits']}"
										minFractionDigits="#{messages['common.minFractionDigits']}" />
								</h:outputText>
							</rich:column>

							<rich:column width="8%" styleClass="right">
								<f:facet name="header">#{messages['municipalBond.surchargesTotal']}</f:facet>
								<h:outputText value="#{_municipalBondItem.municipalBond.surcharge}">
									<f:convertNumber
										maxFractionDigits="#{messages['common.maxFractionDigits']}"
										minFractionDigits="#{messages['common.minFractionDigits']}" />
								</h:outputText>
							</rich:column>
							
							<rich:column width="8%" styleClass="right">
								<f:facet name="header">#{messages['municipalBond.taxesTotal']}</f:facet>
								<h:outputText value="#{_municipalBondItem.municipalBond.taxesTotal}">
									<f:convertNumber
										maxFractionDigits="#{messages['common.maxFractionDigits']}"
										minFractionDigits="#{messages['common.minFractionDigits']}" />
								</h:outputText>
							</rich:column>

							<rich:column width="8%" styleClass="right">
								<f:facet name="header">#{messages['municipalBond.paidTotal']}</f:facet>
								<h:outputText value="#{_municipalBondItem.municipalBond.paidTotal}">
									<f:convertNumber
										maxFractionDigits="#{messages['common.maxFractionDigits']}"
										minFractionDigits="#{messages['common.minFractionDigits']}" />
								</h:outputText>
							</rich:column>
						</rich:subTable>
					</rich:subTable>
				</rich:dataTable>
			</a:outputPanel>
			
			<rich:panel rendered="#{not empty paymentAgreementHome.instance.id}">
				<f:facet name="header">
					<h:outputText value="#{messages['paymentAgreement.dividends']}" />
				</f:facet>
				
				<rich:dataTable
					id="dividendsTable" var="_dividend"
					value="#{paymentAgreementHome.instance.dividends}"
					rendered="#{paymentAgreementHome.instance.dividends.size() > 0}"
					columnClasses="center, right, right">
	
					<rich:column width="200">
						<f:facet name="header">
							#{messages['dividend.date']}
						</f:facet>
						<rich:calendar 
							value="#{_dividend.date}"   
							size="10" disabled="true"
							datePattern="#{messages['common.datePattern']}"/>
						</rich:column>
						<rich:column width="200" styleClass="right">
							<f:facet name="header">
								#{messages['dividend.balance']}
							</f:facet>
							<h:inputText value="#{_dividend.balance}" style="width:100%; border: 0px solid;" styleClass="right">
								<f:convertNumber
									maxFractionDigits="#{messages['common.maxFractionDigits']}"
									minFractionDigits="#{messages['common.minFractionDigits']}" />
							</h:inputText>
						</rich:column>
						<rich:column width="200" styleClass="right">
							<f:facet name="header">
								#{messages['dividend.amount']}
							</f:facet>
							<h:inputText value="#{_dividend.amount}" style="width:100%; border: 0px solid;" styleClass="right">
								<f:convertNumber
									maxFractionDigits="#{messages['common.maxFractionDigits']}"
									minFractionDigits="#{messages['common.minFractionDigits']}" />
							</h:inputText>
						</rich:column>
					</rich:dataTable>
				</rich:panel>
			

			<div class="actionButtons">
				<s:button id="printBtn" rendered="#{paymentAgreementHome.managed or paymentAgreementHome.readyForPrint}"
						view="/income/report/PaymentAgreementReport.xhtml"
						value="#{messages['common.print']}" propagation="join">
				</s:button>
				
				<s:button id="exitBtn"
						view="/income/PaymentAgreementList.xhtml"
						value="#{messages['common.exit']}" propagation="none">
				</s:button>
			</div>
		</h:form>

	</ui:define>
</ui:composition>
