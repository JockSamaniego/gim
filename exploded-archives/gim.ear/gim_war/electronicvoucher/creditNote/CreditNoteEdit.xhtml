<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j" xmlns:g="http://gim.gob.ec/jsf"
	xmlns:rich="http://richfaces.org/rich"
	template="../../layout/template.xhtml">

	<ui:define name="body">
		<style type="text/css">
.foo td {
	vertical-align: top;
}
</style>
		<h:form id="retention" styleClass="edit">
			<h:outputText styleClass="formTitle"
				value="#{messages['creditNote.title']}" />
			<rich:panel>
				<f:facet name="header">
					#{messages['Documentoquesemodifica']}
				</f:facet>
				
				<s:decorate id="emissionDateDec" template="../../layout/edit.xhtml">
					<ui:define name="label">
							#{messages['electronicVoucher.emissionDate']}
						</ui:define>
					<rich:calendar id="emissionDate" required="true"
						value="#{creditNoteElectHome.instance.emissionDate}"
						datePattern="#{messages['common.datePattern']}" inputSize="20">
						<f:convertDateTime type="date"
							pattern="#{messages['common.datePattern']}" />
						<a:support event="onchanged" ajaxSingle="true" />
					</rich:calendar>
				</s:decorate>
					<div style="clear: both"></div>
					<s:decorate id="vouchertoModifyDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['creditNote.docModify']}:</ui:define>
						<h:outputText id="vouchertoModify" value="#{creditNoteElectHome.instance.documentModify}" ></h:outputText>
					</s:decorate>
					
					<s:decorate id="nroVoucherDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['electronicVoucher.documentNumber']}:</ui:define>
						<h:outputText id="nroVoucher" value="#{creditNoteElectHome.instance.documentNumber}" ></h:outputText>
					</s:decorate>
					
					<s:decorate id="docNumberDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['electronicVoucher.documentDate']}:</ui:define>
						<h:outputText id="docNumber" value="#{creditNoteElectHome.instance.documentDate}" ></h:outputText>
					</s:decorate>
					
					<s:decorate id="residentDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['electronicVoucher.user']}:</ui:define>
						<h:outputText id="resident" value="#{creditNoteElectHome.instance.resident.name} - #{creditNoteElectHome.instance.resident.identificationNumber}"  ></h:outputText>
					</s:decorate>
					
					<s:decorate id="reasonDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['creditNote.reason']}: </ui:define>
						<h:inputTextarea cols="30" rows="5" value="#{creditNoteElectHome.instance.reason}" required="true" ></h:inputTextarea>
					</s:decorate>
			<div style="clear: both"></div>
			</rich:panel>


			<rich:panel id="detailsPanel">
				<rich:dataTable id="detailCreditNote" var="_item"
					rowClasses="odd-row, even-row"
					value="#{creditNoteElectHome.instance.items}">

					<f:facet name="header">
						<h:panelGrid columns="4" columnClasses="left headerTitle,">
							 
							<h:outputText value="#{messages['municipalBond.number']}"
								rendered="#{!creditNoteElectHome.managed}" />

							<h:inputText id="municipalBondNumber"
								value="#{creditNoteElectHome.municipalBondNumber}"
								rendered="#{!creditElectNoteHome.managed}">
								<a:support event="onblur" ajaxSingle="true" />
							</h:inputText>

							<a:commandButton id="addBtn"
								action="#{creditNoteElectHome.addMunicipalBond()}"
								value="#{messages['common.add']}"
								reRender="detailCreditNote, messages, vouchertoModify, 
								nroVoucher, docNumber, resident"
								rendered="#{!creditNoteElectHome.managed}" 
								ajaxSingle="true" />
						</h:panelGrid>
					</f:facet>

					<rich:column styleClass="action">
						<f:facet name="header">#{messages['cashRecord.amount']}</f:facet>
						<h:inputText value="#{_item.amount}" size="5"></h:inputText>
					</rich:column>

					<rich:column sortBy="_item.entry.name" styleClass="action">
						<f:facet name="header">#{messages['paymentAgreement.description']}</f:facet>
						<h:outputText value="#{_item.entry.name}"></h:outputText>
					</rich:column>

					<rich:column sortBy="#{_item.value}" styleClass="action">
						<f:facet name="header">#{messages['creditNote.unitaryPrice']}</f:facet>
						<h:inputText  value="#{_item.value}" size="10" style="text-align: right" >
							<a:support event="onblur" ajaxSingle="true" 
							action="#{creditNoteElectHome.calculateRow(_item)}" 
							reRender="detailCreditNote,subtotal,bi12,bi0,bitt,total"/>
						</h:inputText>
					</rich:column>

					<rich:column sortBy="#{_item.total}" styleClass="action">
						<f:facet name="header">#{messages['cashRecord.total']}</f:facet>
						<h:outputText value="#{_item.total}" >
							<f:convertNumber maxFractionDigits="2" groupingUsed="false" />
						</h:outputText>
					</rich:column>
				</rich:dataTable>
				<div style="clear: both"></div>
				
			</rich:panel>
			<s:decorate id="subtotalDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['creditNote.subtotal']}: </ui:define>
						<h:outputText id="subtotal" value="#{creditNoteElectHome.instance.total}" >
							<f:convertNumber maxFractionDigits="2" groupingUsed="false" />
						</h:outputText>
			</s:decorate>
			<s:decorate id="bi12Dec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['creditNote.base12']}: </ui:define>
						<h:outputText id="bi12" value="#{creditNoteElectHome.instance.taxableTotal}" >
							<f:convertNumber maxFractionDigits="2" groupingUsed="false" />
						</h:outputText>
			</s:decorate>
			<s:decorate id="bi0ec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['creditNote.base0']}: </ui:define>
						<h:outputText id="bi0" value="#{creditNoteElectHome.instance.nonTaxableTotal}" >
							<f:convertNumber maxFractionDigits="2" groupingUsed="false" />
						</h:outputText>
			</s:decorate>
			
			<s:decorate id="bittDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['creditNote.iva']}: </ui:define>
						<h:outputText id="bitt" value="#{creditNoteElectHome.instance.totalTaxes}" >
							<f:convertNumber maxFractionDigits="2" groupingUsed="false" />
						</h:outputText>
			</s:decorate>
			
			<s:decorate id="totalDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['cashRecord.total']}: </ui:define>
						<h:outputText id="total" value="#{creditNoteElectHome.instance.totalPaid}" >
							<f:convertNumber maxFractionDigits="2" groupingUsed="false" />
						</h:outputText>
			</s:decorate>

			<div style="clear: both"></div>

			
			<!-- Campos adicionales -->
			<rich:panel id="AditionalFields">
				<f:facet name="header">
					<h:panelGrid columns="2" columnClasses="headerTitle,">
						<h:outputText id="labelRecord"
							value="#{messages['electronicVoucher.aditionalFields']}" />
						<s:div styleClass="actionButtons" rendered="#{empty from}">
							<a:commandButton ajaxSingle="true"
								value="#{messages['common.add']} #{messages['electronicVoucher.aditionalFields']}"
								oncomplete="Richfaces.showModalPanel('aditionalFieldsForm');"
								action="#{creditNoteElectHome.addField}"
								bypassUpdates="true" reRender="aditionalFieldsForm" />
						</s:div>
					</h:panelGrid>
				</f:facet>
				
				<rich:dataTable id="aditionFieldTable" var="field"
					rowClasses="odd-row, even-row"
					value="#{creditNoteElectHome.instance.fields}">
					 <rich:column styleClass="action">
						<f:facet name="header">#{messages['electronicVoucher.field']}</f:facet>
						<h:outputText value="#{field.label}"></h:outputText>
					</rich:column>
					 <rich:column styleClass="action">
						<f:facet name="header">#{messages['electronicVoucher.value']}</f:facet>
						<h:outputText value="#{field.value}"></h:outputText>
					</rich:column>
				</rich:dataTable>
			</rich:panel>

			<div class="actionButtons">
				<h:commandButton id="save" value="#{messages['common.save']}"
					action="#{creditNoteElectHome.persist}"
					disabled="#{!creditNoteElectHome.wired}"
					rendered="#{!creditNoteElectHome.managed}" />

				<h:commandButton id="update" value="#{messages['common.save']}"
					action="#{creditNoteElectHome.update}"
					rendered="#{creditNoteElectHome.managed}" />

				<!-- h:commandButton id="delete" value="Delete"
					action="# { marketHome.remove}" immediate="true"
					rendered="# { creditNoteElectHome.managed}" / -->

				<s:button id="cancelEdit" value="#{messages['common.cancel']}"
					propagation="end"
					view="/electronicvoucher/creditNote/CreditNoteList.xhtml" />
			</div>
		</h:form>
		
		<!--  DIALOGO PARA GUARDAR CAMPOS ADICIONALES  -->
		<rich:modalPanel id="aditionalFieldsForm" width="600" height="210"
			style="overflow:auto">
			<h:form id="FieldForm" styleClass="edit">
				<rich:panel>
					<f:facet name="header">
						<h:panelGroup>
							<h:outputText value="#{messages['electronicVoucher.detail']}"></h:outputText>
						</h:panelGroup>
					</f:facet>
					<s:decorate id="fieldDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['electronicVoucher.field']}</ui:define>
						<h:inputText value="#{creditNoteElectHome.field.label}"  
						required="true" maxlength="50" size="50"  onkeyup="this.value=this.value.toUpperCase()">
							<a:support event="onblur" ajaxSingle="true" />
						</h:inputText>
					</s:decorate>
					
					<s:decorate id="ValueDec" template="../../layout/edit.xhtml">
						<ui:define name="label">#{messages['electronicVoucher.value']}</ui:define>
						<h:inputTextarea id="valueField" value="#{creditNoteElectHome.field.value}"
						required="true"
						cols="50" rows="3" onkeyup="this.value=this.value.toUpperCase()">
							<a:support event="onblur" reRender="valueField"
								ajaxSingle="true" />
							<f:validateLength maximum="300" />
						</h:inputTextarea>
					</s:decorate>
					
					<div style="clear: both">
						<span class="required">*</span> #{messages['common.requiredFields']}
					</div>
					<s:div styleClass="actionButtons" rendered="#{empty from}">
						<a:commandButton id="saveAFtn" value="#{messages['common.save']}"
							action="#{creditNoteElectHome.putField}" ajaxSingle="true"
							reRender="aditionFieldTable" 
							oncomplete="#{facesContext.maximumSeverity == null ? 'Richfaces.hideModalPanel(\'aditionalFieldsForm\');' : ''}"  />
						<a:commandButton id="cancelMBtn" ajaxSingle="true"
							value="#{messages['common.cancel']}"
							oncomplete="Richfaces.hideModalPanel('aditionalFieldsForm');"
							bypassUpdates="true" />
					</s:div>
				</rich:panel>
			</h:form>
		</rich:modalPanel>
		
		
		 
		
	</ui:define>
</ui:composition>